<semantic-form
  id='{{viewId}}-vocab-form' 
  post-action="event"
  subject='{{node}}'
  new-subject-template="https://veniss.net/resource/source/{{{{raw}}}}{{UUID}}{{{{/raw}}}}"
  fields='[[ fieldDefinitions
    type                                = "http://www.w3.org/1999/02/22-rdf-syntax-ns#type"

    source_representation               = "https://veniss.net/container/fieldDefinitionContainer/source_representation"
    source_attributed_title             = "https://veniss.net/container/fieldDefinitionContainer/source_attributed_title"
    source_original_title               = "https://veniss.net/container/fieldDefinitionContainer/source_original_title"
    source_typology                     = "https://veniss.net/container/fieldDefinitionContainer/source_typology"
    source_author                       = "https://veniss.net/container/fieldDefinitionContainer/source_author"
    source_date                         = "https://veniss.net/container/fieldDefinitionContainer/source_date"
    source_date_composite               = "https://veniss.net/container/fieldDefinitionContainer/source_date_composite"
    source_location                     = "https://veniss.net/container/fieldDefinitionContainer/source_location"
    source_location_type                = "https://veniss.net/container/fieldDefinitionContainer/source_location_type"
    source_location_name                = "https://veniss.net/container/fieldDefinitionContainer/source_location_name"
    source_technique                    = "https://veniss.net/container/fieldDefinitionContainer/source_technique"
    source_dimension                    = "https://veniss.net/container/fieldDefinitionContainer/source_dimension"
    source_dimension_unit               = "https://veniss.net/container/fieldDefinitionContainer/source_dimension_unit"
    source_comment                      = "https://veniss.net/container/fieldDefinitionContainer/source_comment"
    source_synopsis                     = "https://veniss.net/container/fieldDefinitionContainer/source_synopsis"
    source_transcription                = "https://veniss.net/container/fieldDefinitionContainer/source_transcription"
    
  ]]'
>
<div class="form-scroll-area">

  <semantic-form-recover-notification></semantic-form-recover-notification>
  <semantic-form-errors></semantic-form-errors>
  <semantic-form-hidden-input for="type" default-values='["http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object","https://veniss.net/ontology#Source", "https://veniss.net/ontology#Source_Primary"]'></semantic-form-hidden-input>

  <div class="container-fluid">
    <div data-flex-layout="row stretch-stretch">

      <!-- Left -->
      <div data-flex-self="size-x2">

        <div data-flex-layout="column stretch-stretch">

          <!-- Representation and titles -->
          <div data-flex-layout="row top-stretch">

            <div id="source_visual_representation" class="padding-5">
              <semantic-form-file-input 
                label="Visual representation"
                for="source_representation"
                storage='images'
                temp-storage='tmp'
                placeholder='Add file here'
                name-predicate-iri='http://www.researchspace.org/ontology/PX_has_file_name'
                media-type-predicate-iri='http://www.researchspace.org/ontology/PX_has_media_type'
                resource-query='
                  PREFIX rso: <http://www.researchspace.org/ontology/>
                  CONSTRUCT {
                    ?__resourceIri__ a rso:EX_File.
                    ?__resourceIri__ rso:PX_has_file_name ?__fileName__.
                    ?__resourceIri__ rso:PX_has_media_type ?__mediaType__.
                    ?__resourceIri__ rdfs:label ?__filename__.
                  } WHERE {}
                '
                generate-iri-query='
                  SELECT ?resourceIri {
                    BIND(IRI(CONCAT(STR(Default:), "EX_File/", ?__fileName__)) AS ?resourceIri) .
                  }
                '
              ></semantic-form-file-input>
            </div>

            <div data-flex-layout="column top-stretch" data-flex-self="size-x3">

              <div id="source_attributed_title" class="padding-5">
                <semantic-form-text-input languages='["en", "it"]' label="Attributed title" for="source_attributed_title"></semantic-form-text-input>
              </div>

              <div id="source_original_title" class="padding-5">
                <semantic-form-text-input languages='["en", "it"]' label="Original title" for="source_original_title"></semantic-form-text-input>
              </div>

              <div id="source_typology" class="padding-5">
                <semantic-form-tree-picker-input 
                  for='source_typology'
                  label="Typology"
                  placeholder="Click and start type"
                  tree-patterns='{
                    "relationPattern": "?item skos:broader ?parent", 
                    "schemePattern": "?item crm:P71i_is_listed_in <http://www.researchspace.org/resource/vocab/source_typologies>"
                  }'>
                </semantic-form-tree-picker-input>
              </div>

            </div>

          </div>

          <hr>

          <!-- Author and Date -->
          <div data-flex-layout="row top-stretch">

            <div id="source_author" class="padding-5">
              <semantic-form-select-input label="Author" for='source_author' placeholder="Start type to filter the authors"></semantic-form-select-input>
            </div>
            
            <div id="source_date_composite" class="padding-5">
              <semantic-form-composite-input label="Creation date" for='source_date_composite' new-subject-template="/creation-date/" fields='[[fieldDefinitions
                time_primitive_day = "https://veniss.net/container/fieldDefinitionContainer/time_primitive_day"
                time_primitive_month = "https://veniss.net/container/fieldDefinitionContainer/time_primitive_month"
                time_primitive_year = "https://veniss.net/container/fieldDefinitionContainer/time_primitive_year"
                time_primitive_note = "https://veniss.net/container/fieldDefinitionContainer/time_primitive_note"
              ]]'>
                <semantic-form-text-input label="day" placeholder="dd" for="time_primitive_day"></semantic-form-text-input>
                <semantic-form-text-input label="month" placeholder="mm" for="time_primitive_month"></semantic-form-text-input>
                <semantic-form-text-input label="year" placeholder="yyyy" for="time_primitive_year"></semantic-form-text-input>
                <semantic-form-text-input label="note" placeholder="Date in natural language" for="time_primitive_note"></semantic-form-text-input>
              </semantic-form-composite-input>
            </div>

          </div>
          <style>
            #source_date_composite > div > div.cardinality-support > div > div > div:nth-child(-n+3){
              display: inline-block;
              margin-right: 2px;
              width: 100px;
            }
            #source_date_composite > div > div.cardinality-support > div > div {
              display: block;
            }
          </style>
          <hr>

          <!-- Archival location  -->
          <div data-flex-layout="row top-stretch">

            <div id="source_location" class="padding-5" data-flex-layout="row top-stretch">
              <div data-flex-self="size-x3">
                <semantic-form-tree-picker-input 
                  open-dropdown-on-focus="false"
                  label="Archival Location" 
                  for='source_location'
                  placeholder="Search for things"
                  custom-button='{
                    "iri": "http://www.researchspace.org/resource/ThinkingFrames",
                    "view": "authority-content",
                    "resource": "http://www.researchspace.org/resource/vocab/archives"
                  }'
                  query-item-label="veniss:has_full_path"
                  tree-patterns='{
                    "relationPattern": "?item crm:P46i_forms_part_of ?parent", 
                    "schemePattern": "?item crm:P71i_is_listed_in <http://www.researchspace.org/resource/vocab/archives>"
                  }'>
                </semantic-form-tree-picker-input>
              </div>
              
            </div>

          </div>

          <div data-flex-layout="row top-stretch">

            <div id="source_location_type" class="padding-5">
              <semantic-form-select-input label="Final source type" placeholder="Choose the source medium" for='source_location_type'>
              </semantic-form-select-input>
            </div>

            <div id="source_location_name" class="padding-5">
              <semantic-form-text-input label="Final source title" placeholder="Write the medium title" for='source_location_name'>
              </semantic-form-text-input> 
            </div>

          </div>

          <hr>

          <!-- Medium and Dimension -->
          <div data-flex-layout="row top-stretch">

            <div id="source_technique" class="padding-5">
              <semantic-form-tree-picker-input  label="Medium" placeholder="Choose the medium" for='source_technique'
                tree-patterns='{
                    "relationPattern": "?item skos:broader ?parent", 
                    "schemePattern": "?item crm:P71i_is_listed_in <http://www.researchspace.org/resource/vocab/source_materials>"
                  }'
                >
              </semantic-form-tree-picker-input>
            </div>

            <div id="source_dimension" class="padding-5">
              <semantic-form-text-input label="Dimensions" placeholder="H x B" for="source_dimension">
              </semantic-form-text-input>
            </div>

            <div id="source_dimension_unit" class="padding-5">
              <semantic-form-select-input label="Dimension unit" placeholder="select the dimension unit" for="source_dimension_unit">
              </semantic-form-select-input>
            </div>

          </div>

          <div data-flex-layout="row top-stretch">
            <div id="source_comment" class="padding-5">
              <semantic-form-text-input label="Additional notes" for="source_comment" placeholder="Enter an additional note here...">
              </semantic-form-text-input>
            </div>
          </div>

          <hr>

          <!-- Synopsis and Transcription --> 
          <div data-flex-layout="row top-stretch">

            <bs-tabs id="tabs">

              <bs-tab event-key="1" title="Synopsis">
                <semantic-form-text-input placeholder="Enter Synopsis ..." multiline="true" rows="5" render-header="false" for='source_synopsis'>
                </semantic-form-text-input> 
              </bs-tab>

              <bs-tab event-key="2" title="Transcription">
                <semantic-form-text-input placeholder="Enter Transcription ..." multiline="true" rows="5" render-header="false" for='source_transcription'>
                </semantic-form-text-input>
              </bs-tab>
            </bs-tabs>

          </div>

          
        </div>


      </div>

      <!-- Right -->
      <div>
        <h3>Related elements</h3>
      </div>
    </div>

  </div>


</div>

[[> rsp:FormDefaultActions]]
</semantic-form>

<style>
  #form-body{
    margin-top: 50px;
  }

  .margin-top{
    margin-top: 40px;
  }

  .FileManager--header {
    display: none !important;
  }

  .cardinality-support__group-instance, .SemanticTreeInput--inputAndButtons {
    border: none !important;
    padding: 0px !important;
  }

  .cardinality-support__single-instance {
    border: none !important;
  }

  .h-1000{
    min-height: 1000px;
  }

  .padding-5 {
    padding: 0 5px;
  }

  .wrapper {
      display: flex;
      flex-direction: column-reverse;
  }

  .open-archival-unit{
    margin-top: 51px;
    border-radius: 0px;
    padding: 10px;
  }

  #source_location .SemanticTreeInput--browseButton{
    margin-right: 10px;
  }

  #source_location .RemovableBadge {
    background-color: white!important;
  }

  #source_location .RemovableBadge__content, #source_location .RemovableBadge__remove {
    max-width: none!important;
    color: black!important;
  }
</style>