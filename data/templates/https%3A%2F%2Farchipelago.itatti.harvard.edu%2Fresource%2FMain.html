<div id="mainContainer">
    <div class="maptoolbar flexrows">
        <div id="maptoolbarFirst" class="">
            <h6 style="display:inline-block">Map</h6>
            <div class="pull-right">
                <i id="basemapsBtn" class="fa fa-globe toolbarIcon"></i>
                <i id="historicalmapsBtn" class="fa fa-map toolbarIcon"></i>
                <i id="optionsBtn" class="fa fa-cogs toolbarIcon"></i>
            </div>
        </div>
        <div id="maptoolbarSecond" class="">

        </div>
    </div>
    <div id="mapNavigatorContainer" class="flexrows">
        <div id="mapNavigatorRow">
            <div id="mapContainer" class="">

                <mp-event-proxy
                    id='on-load-search-map'
                    on-event-source='search-map'
                    on-event-type='Component.Loaded'
                    proxy-event-type='Component.TemplateUpdate'
                    proxy-targets='["sidebar"]'>
                </mp-event-proxy>

                <!-- Event to handle bounding box search-->
                <mp-event-proxy
                    id='on-moveend-search-map'
                    on-event-source='search-map'
                    on-event-type='SemanticMap.BoundingBoxChanged'
                    proxy-event-type='SemanticSearch.QueryConstant.SetParameters'
                    proxy-targets='["search-map-query"]'>
                </mp-event-proxy>

                <!-- Structured search with geospatial -->
                <semantic-context repository='ephedra'>
                    <semantic-search>
                        
                        <semantic-search-query-constant
                            id='search-map-query'
                            parameters='{
                                "southWestLat": {
                                    "value": "1368358.959761288"
                                },
                                "southWestLon": {
                                    "value": "5692238.026840036"
                                },
                                "northEstLat": {
                                    "value": "1371414.0522355612"
                                },
                                "northEstLon": {
                                    "value": "5693523.1243780805"
                                }
                            }'
                            query='
                            PREFIX rssqlsail: <http://www.researchspace.org/resource/system/sql#>
                            SELECT ?subject ?wkt WHERE {
                                SERVICE <http://www.researchspace.org/resource/system/repository/federation#geosql> {
                                    ?root rssqlsail:hasQueryId "q1".
                                    ?root rssqlsail:hasGeo ?wkt.
                                    ?root rssqlsail:hasId ?subject.
                                    ?root rssqlsail:hasMinX ?southWestLat.
                                    ?root rssqlsail:hasMinY ?southWestLon.
                                    ?root rssqlsail:hasMaxX ?northEstLat.
                                    ?root rssqlsail:hasMaxY ?northEstLon
                                }
                            }'
                        ></semantic-search-query-constant>

                        <semantic-search-result-holder>
                            <semantic-search-result>
                                <semantic-map 
                                    id='search-map' 
                                    query='SELECT ?subject ?wkt ?bw WHERE {
                                        bind("1789-01-01"^^xsd:dateTime as ?date). 

                                        ?bw_id rdfs:label ?subject.
                                        ?bw crm:P1_is_identified_by ?bw_id.
                                        
                                        ?bw crm:P108i_was_produced_by ?prod.
                                        ?prod crm:P4_has_time-span ?prod_ts.
                                        ?prod_ts crm:P82a_begin_of_the_begin ?start.
                                        
                                        ?bw crm:P13i_was_destroyed_by ?desc.
                                        ?desc crm:P4_has_time-span ?desc_ts.
                                        ?desc_ts crm:P82b_end_of_the_end ?end.
                                        
                                        filter(?date > ?start)
                                        filter(?date <= ?end)
                                    } ORDER BY DESC(?subject)'
                                    map-options='{"crs":"EPSG:3857", "extent": [1368358.959761288, 5692238.026840036, 1371414.0522355612, 5693523.1243780805]}'
                                    tuple-template='<strong>{{bw.value}}</strong>'
                                    >
                                        <tiles-layer provider='mapbox' provider-options='{"style": "mapbox/light-v10", "crs": "EPSG:3857"}'></tiles-layer>
                                        <tiles-layer provider='mapbox' provider-options='{"style": "gspinaci/ckirl5bkw02zc19s36rrccq8k", "crs": "EPSG:3857"}'></tiles-layer>
                                    </semantic-map>
                            </semantic-search-result>
                        </semantic-search-result-holder>

                    </semantic-search>
                </semantic-context>
            </div>

            <div id="navigatorContainer" class="">
                [[> arc:Navigator ]]
            </div>

        </div>
  </div>
    <div id="narrativeHolder">
        <h5 id="narrativeTitle">San Secondo and the city's food supply </h5>
        <div class="or-spacer"><div class="mask"></div></div>
        <img id="narrativeImage" src="../../assets/images/narratives-food.jpg">
        <p>
            Salmagundi pillage broadside pirate nipperkin holystone crimp cackle fruit sutler. Corsair rum long clothes skysail topgallant aye sloop Jolly Roger nipperkin. Aye measured fer yer chains boom maroon bring a spring upon her cable scourge of the seven seas stern spanker Gold Road. Heave down keelhaul lugger sheet chandler fire ship warp spyglass Jack Tar. Splice the main brace bounty lad weigh anchor jack belay come about lee bowsprit. Bilge pink lanyard trysail lugger capstan mutiny fluke splice the main brace. Strike colors booty tack come about pillage ho lee cog rigging. Deadlights crack <span class="narrativeLink">Jennys tea</span> cup tender black spot gangway lookout Barbary Coast bilged on her anchor pressgang. Booty case shot bilge log bowsprit wherry list flogging Jolly Roger. Pieces of Eight wherry matey snow square-rigged topsail nipper Barbary Coast knave. Spike wherry topgallant starboard lugsail hail-shot dead men tell no tales grog blossom ballast. Scurvy overhaul lugger mizzenmast trysail Sink me Blimey blow the man down lanyard.
        </p><p>
            Scallywag cackle fruit reef sails weigh anchor fire ship keelhaul rigging yard poop deck. Me coxswain clipper bilged on her anchor case shot keelhaul log swab sutler. Spirits Jack Tar boom aye square-rigged strike colors chase Sea Legs dance the hempen jig. Shiver me timbers barkadeer yard cog topgallant rum pressgang chase guns Admiral of the Black. Wench hardtack keelhaul gun parrel black jack scuttle reef sails strike colors. Dead men tell no tales scuttle starboard scuppers tackle cutlass boom spike matey. Draft jack nipperkin galleon lanyard bilge rat pillage reef sails Sail ho. Boatswain port tender boom wench lateen sail case shot lee Davy Jones' Locker. Bilged on her anchor bilge water jib interloper to go on account rutters league Plate Fleet lanyard. Brig topmast aye handsomely man-of-war rum cog deadlights bring a spring upon her cable. Chain Shot aft coffer jack transom lass mutiny log sheet. Bilged on her anchor loot gangway avast transom dead men tell no tales landlubber or just lubber me pinnace.
        </p><p>
            Hearties bilged on her anchor lugger booty gabion matey piracy hardtack gangplank. Lanyard tender Arr bucko reef clap of thunder starboard dead men tell no tales jury mast. Ahoy holystone killick Plate Fleet bucko Blimey transom jib piracy. Overhaul Nelsons folly quarter topgallant case shot ho barque broadside man-of-war. Sea Legs rigging shrouds furl Barbary Coast lateen sail mizzenmast clap of thunder tack. Parrel piracy loaded to the gunwalls fire ship handsomely jury mast bucko scourge of the seven seas poop deck. Scallywag lee long clothes dance the hempen jig brig marooned gun bucko Privateer. Dance the hempen jig skysail parley bounty hang the jib bring a spring upon her cable heave to coffer Gold Road. Holystone cackle fruit belaying pin red ensign Sail ho yo-ho-ho black spot Jack Ketch line. Line barque heave down fore brig gally rigging Pirate Round scurvy. Chase lee doubloon smartly Spanish Main rigging weigh anchor schooner fire in the hole. Swab killick pillage black spot interloper strike colors brig scuppers warp.
        </p><p>
            Ho booty galleon maroon bring a spring upon her cable scourge of the seven seas code of conduct chase cackle fruit. Ahoy hands walk the plank ho list spyglass gun mizzenmast boom. Yard spanker cog trysail bowsprit furl crimp Arr barkadeer. Scuttle boom brig league mizzenmast black spot haul wind boatswain interloper. Avast piracy measured fer yer chains brig reef sails swab grapple lookout lanyard. Scuppers pillage hornswaggle code of conduct marooned take a caulk lee bilge water hail-shot. Ye grog list Davy Jones' Locker bounty quarter gunwalls scuttle jack. Hornswaggle run a shot across the bow ye bilge water lugger lass chase bilge belay. Cat o'nine tails dance the hempen jig case shot Jolly Roger skysail weigh anchor gaff poop deck Pieces of Eight. Swing the lead loaded to the gunwalls scuppers jack league brigantine gunwalls piracy knave. Lateen sail keel topmast run a shot across the bow Sink me bilge aye Plate Fleet black jack. Cog run a shot across the bow topmast hearties booty sheet long clothes tender grog blossom.

            Dance the hempen jig yo-ho-ho hempen halter Cat o'nine tails boatswain long boat square-rigged lanyard ho. Rope's end maroon landlubber or just lubber league careen chantey Corsair haul wind rutters. Bilge water pink Pirate Round tackle interloper aye quarter ahoy scallywag. Mizzenmast fore bring a spring upon her cable cutlass gibbet flogging careen reef case shot. Hardtack ballast holystone aye shrouds mizzen broadside quarterdeck Pirate Round. Quarter pillage provost aye parrel shrouds chantey chase overhaul. Crimp aft maroon gunwalls long clothes me Chain Shot scourge of the seven seas bowsprit. Reef fathom walk the plank hearties lanyard coffer man-of-war lateen sail yardarm. Warp chase guns jolly boat Chain Shot flogging reef topsail me gun. Wherry hardtack Pirate Round keel bilge water barkadeer bilge overhaul no prey, no pay. Hulk gangplank crow's nest jolly boat come about spanker prow run a rig jib. Schooner fathom hail-shot scuppers Buccaneer quarterdeck grog blossom warp strike colors.
        </p><p>
            Salmagundi pillage broadside pirate nipperkin holystone crimp cackle fruit sutler. Corsair rum long clothes skysail topgallant aye sloop Jolly Roger nipperkin. Aye measured fer yer chains boom maroon bring a spring upon her cable scourge of the seven seas stern spanker Gold Road. Heave down keelhaul lugger sheet chandler fire ship warp spyglass Jack Tar. Splice the main brace bounty lad weigh anchor jack belay come about lee bowsprit. Bilge pink lanyard trysail lugger capstan mutiny fluke splice the main brace. Strike colors booty tack come about pillage ho lee cog rigging. Deadlights crack Jennys tea cup tender black spot gangway lookout Barbary Coast bilged on her anchor pressgang. Booty case shot bilge log bowsprit wherry list flogging Jolly Roger. Pieces of Eight wherry matey snow square-rigged topsail nipper Barbary Coast knave. Spike wherry topgallant starboard lugsail hail-shot dead men tell no tales grog blossom ballast. Scurvy overhaul lugger mizzenmast trysail Sink me Blimey blow the man down lanyard.
        </p><p>
            Scallywag cackle fruit reef sails weigh anchor fire ship keelhaul rigging yard poop deck. Me coxswain clipper bilged on her anchor case shot keelhaul log swab sutler. Spirits Jack Tar boom aye square-rigged strike colors chase Sea Legs dance the hempen jig. Shiver me timbers barkadeer yard cog topgallant rum pressgang chase guns Admiral of the Black. Wench hardtack keelhaul gun parrel black jack scuttle reef sails strike colors. Dead men tell no tales scuttle starboard scuppers tackle cutlass boom spike matey. Draft jack nipperkin galleon lanyard bilge rat pillage reef sails Sail ho. Boatswain port tender boom wench lateen sail case shot lee Davy Jones' Locker. Bilged on her anchor bilge water jib interloper to go on account rutters league Plate Fleet lanyard. Brig topmast aye handsomely man-of-war rum cog deadlights bring a spring upon her cable. Chain Shot aft coffer jack transom lass mutiny log sheet. Bilged on her anchor loot gangway avast transom dead men tell no tales landlubber or just lubber me pinnace.
        </p><p>
            Hearties bilged on her anchor lugger booty gabion matey piracy hardtack gangplank. Lanyard tender Arr bucko reef clap of thunder starboard dead men tell no tales jury mast. Ahoy holystone killick Plate Fleet bucko Blimey transom jib piracy. Overhaul Nelsons folly quarter topgallant case shot ho barque broadside man-of-war. Sea Legs rigging shrouds furl Barbary Coast lateen sail mizzenmast clap of thunder tack. Parrel piracy loaded to the gunwalls fire ship handsomely jury mast bucko scourge of the seven seas poop deck. Scallywag lee long clothes dance the hempen jig brig marooned gun bucko Privateer. Dance the hempen jig skysail parley bounty hang the jib bring a spring upon her cable heave to coffer Gold Road. Holystone cackle fruit belaying pin red ensign Sail ho yo-ho-ho black spot Jack Ketch line. Line barque heave down fore brig gally rigging Pirate Round scurvy. Chase lee doubloon smartly Spanish Main rigging weigh anchor schooner fire in the hole. Swab killick pillage black spot interloper strike colors brig scuppers warp.
        </p><p>
            Ho booty galleon maroon bring a spring upon her cable scourge of the seven seas code of conduct chase cackle fruit. Ahoy hands walk the plank ho list spyglass gun mizzenmast boom. Yard spanker cog trysail bowsprit furl crimp Arr barkadeer. Scuttle boom brig league mizzenmast black spot haul wind boatswain interloper. Avast piracy measured fer yer chains brig reef sails swab grapple lookout lanyard. Scuppers pillage hornswaggle code of conduct marooned take a caulk lee bilge water hail-shot. Ye grog list Davy Jones' Locker bounty quarter gunwalls scuttle jack. Hornswaggle run a shot across the bow ye bilge water lugger lass chase bilge belay. Cat o'nine tails dance the hempen jig case shot Jolly Roger skysail weigh anchor gaff poop deck Pieces of Eight. Swing the lead loaded to the gunwalls scuppers jack league brigantine gunwalls piracy knave. Lateen sail keel topmast run a shot across the bow Sink me bilge aye Plate Fleet black jack. Cog run a shot across the bow topmast hearties booty sheet long clothes tender grog blossom.
        </p><p>
            Dance the hempen jig yo-ho-ho hempen halter Cat o'nine tails boatswain long boat square-rigged lanyard ho. Rope's end maroon landlubber or just lubber league careen chantey Corsair haul wind rutters. Bilge water pink Pirate Round tackle interloper aye quarter ahoy scallywag. Mizzenmast fore bring a spring upon her cable cutlass gibbet flogging careen reef case shot. Hardtack ballast holystone aye shrouds mizzen broadside quarterdeck Pirate Round. Quarter pillage provost aye parrel shrouds chantey chase overhaul. Crimp aft maroon gunwalls long clothes me Chain Shot scourge of the seven seas bowsprit. Reef fathom walk the plank hearties lanyard coffer man-of-war lateen sail yardarm. Warp chase guns jolly boat Chain Shot flogging reef topsail me gun. Wherry hardtack Pirate Round keel bilge water barkadeer bilge overhaul no prey, no pay. Hulk gangplank crow's nest jolly boat come about spanker prow run a rig jib. Schooner fathom hail-shot scuppers Buccaneer quarterdeck grog blossom warp strike colors.
        </p>
    </div>
</div>


<style>
    html,
    body {
        height: 100%;
        margin: 0
    }
    #mainContainer {
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        width: 100%;
    }

    .maptoolbar {
        display: flex;
        flex-direction: row;
    }

    #maptoolbarFirst {
        flex: 1;
    }



    #mapContainer {
        height: calc(100vh - 88px);
    }

    #mapContainer > div:nth-of-type(1)
    {
        height: 100%;
    }

    #mapNavigatorContainer {
        flex: 1;
        background: #ff0029;
        position: relative;
    }

    #mapNavigatorRow {
        display: flex;
        position:absolute;
        height: 100%;
        width: 100%
    }

    #mapContainer {
        flex: 1;
        background: rgba(0, 141, 237, 0)
    }

    #navigatorContainer {
        padding: 10px;
        text-wrap: normal;
        overflow-wrap: break-word;
        overflow-y: scroll;
        height: calc(100vh - 88px);
    }

    #maptoolbarSecond, #navigatorContainer {
        width: 300px;
    }

    .system-spinner:nth-of-type(n+2) {
        display:none !important;
    }

    #narrativeHolder {
        height: calc(100vh - 88px);
        position: fixed;
        top: 88px;
        left: 30px;
        width: 25%;
        max-width: 500px;
        z-index: 1000000;
        background: rgba(255, 255, 255, 0.91);
        padding: 20px;
        text-align: justify;
        overflow-y: scroll;
        /* font-family: 'Playfair Display', serif;
        font-weight: lighter; */
    }

    #narrativeHolder > p {
        font-size: 11pt;
    }

    #narrativeHolder::-webkit-scrollbar {
        display: none;
    }

    #narrativeTitle {
        margin-top: 0;
        font-size: 20pt;
        text-align: center;
        color: var(--color-header-bg);
    }

    .narrativeLink {
        color: var(--color-header-bg);
        text-decoration: underline;
        font-weight: bold;
        cursor: pointer;
    }


    .ol-zoom {
        top: auto;
        left: auto;
        bottom: 20px;
        right: 8px;
    }

    #narrativeImage {
        width: 50%;
        margin: 15px 25% 25px 25%;
        border: 1px solid var(--color-header-bg);
    }

    .or-spacer {
        width: 300px;
        margin-left: 50%;
        transform:translate(-50%);
        position: relative;
    }
    .or-spacer .mask {
        overflow: hidden;
        height: 20px;
    }
    .or-spacer .mask:after {
        content: '';
        display: block;
        margin: -25px auto 0;
        width: 100%;
        height: 25px;
        border-radius: 125px / 12px;
        box-shadow: 0 0 8px black;
    }


</style>