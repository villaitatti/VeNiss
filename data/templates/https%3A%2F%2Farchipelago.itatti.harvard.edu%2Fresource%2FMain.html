<!-- try (TupleQueryResult tqr = con.prepareTupleQuery("SELECT * WHERE { ?a ?b ?c optional { ?root <http://www.researchspace.org/resource/system/sql#hasQueryId> 'q2'} } LIMIT 1").evaluate()) { -->
<link rel="stylesheet" href="../../assets/styles/archipelago-main.css" />
<div id="mainContainer">
  <div class="maptoolbar flexrows">
    <div id="maptoolbarFirst" class="">
      <h6 id="maptoolbarTitle">Interactive Narrative</h6>
      <div class="pull-right">
        <mp-event-trigger
          id="event-trigger2"
          type="Component.TemplateUpdate"
          data='{"showbasemaps": true}'
          targets='["sidebar"]'
        >
          <i id="basemapsBtn" class="fa fa-globe toolbarIcon"></i>
        </mp-event-trigger>
        <mp-event-trigger
          id="event-trigger3"
          type="Component.TemplateUpdate"
          data='{"showhistoricalmaps": true}'
          targets='["sidebar"]'
        >
          <i id="historicalmapsBtn" class="fa fa-map toolbarIcon"></i>
        </mp-event-trigger>
        <mp-event-trigger
          id="event-trigger4"
          type="Component.TemplateUpdate"
          data='{"showoptions": true}'
          targets='["sidebar"]'
        >
          <i id="optionsBtn" class="fa fa-cogs toolbarIcon"></i>
        </mp-event-trigger>
        <mp-event-trigger
          id="event-trigger5"
          type="Component.TemplateUpdate"
          data='{"showentities": true}'
          targets='["sidebar"]'
        >
          <i id="entitiesBtn" class="fa fa-id-card toolbarIcon"></i>
        </mp-event-trigger>
      </div>
    </div>
    <div id="maptoolbarSecond" class=""></div>
  </div>

  <div id="mapNavigatorContainer" class="flexrows">
    <!-- Event to handle bounding box search-->
    <mp-event-proxy
      id="on-moveend-search-map"
      on-event-source="search-map"
      on-event-type="SemanticMap.BoundingBoxChanged"
      proxy-event-type="SemanticSearch.QueryConstant.SetParameters"
      proxy-targets='["search-map-query"]'
    >
    </mp-event-proxy>

    <!-- Structured search with geospatial -->
    <semantic-context repository="ephedra">
      <semantic-search>
        <semantic-search-query-constant
          id="search-map-query"
          parameters='{
                        "southWestLat": {
                            "value": "1368358.959761288"
                        },
                        "southWestLon": {
                            "value": "5692238.026840036"
                        },
                        "northEstLat": {
                            "value": "1371414.0522355612"
                        },
                        "northEstLon": {
                            "value": "5693523.1243780805"
                        }
                    }'
          query='
                        PREFIX archipelago: <http://www.researchspace.org/resource/system/service/archipelago#>
                        PREFIX rssqlsail: <http://www.researchspace.org/resource/system/sql#>
                        SELECT ?subject ?bw_id ?wkt WHERE {
                            service <http://www.researchspace.org/resource/system/repository/federation#geosql> {
                              ?root rssqlsail:hasQueryId "test";	
                                archipelago:wkt ?wkt;
                                archipelago:bw_id ?bw_id;
                                archipelago:minX ?southWestLat;
                                archipelago:minY ?southWestLon;
                                archipelago:maxX ?northEstLat;
                                archipelago:maxY ?northEstLon
                            }                                        
                            BIND(IRI(CONCAT("https://archipelago.itatti.harvard.edu/resource/built_work/", ?bw_id)) as ?subject)
                        }'
        ></semantic-search-query-constant>

        <semantic-search-result-holder>
          <div id="mapNavigatorRow">
            <div id="mapContainer">[[> arc:Map ]]</div>
            <div id="navigatorContainer">[[> arc:Navigator ]]</div>
          </div>
        </semantic-search-result-holder>
      </semantic-search>
    </semantic-context>
  </div>
</div>
